!function(){"use strict";var e={size:16,emptyCellPostion:void 0,cellsCanMove:[],timer:{time:0,seconds:0,minutes:0,started:!0},moves:0,sound:!0,numOfMoves:null},t=()=>{const t=document.querySelectorAll(".cell"),n=e.cellsCanMove;t.forEach((e=>{const t=+e.dataset.position;e.querySelector(".number")&&(n.includes(t)?e.querySelector(".number").classList.add("canMove"):e.querySelector(".number")&&e.querySelector(".number").classList.remove("canMove"))}))};const n=()=>{const t=document.querySelector(`[data-position="${e.emptyCellPostion}"]`);let o;function s(e){o=this,e.target.parentElement.removeAttribute("onclick"),e.dataTransfer.setData("numberOfCell",this.parentElement.dataset.number)}function r(e){e.target.parentElement.setAttribute("onclick","changeCellPosition(this, true)")}function a(e){e.preventDefault()}function l(e){t.removeEventListener("dragover",a),t.removeEventListener("drop",l);const n=e.dataTransfer.getData("numberOfcell"),o=document.querySelector(`[data-number="${n}"]`);changeCellPosition(o)}document.querySelectorAll(".number").forEach((e=>{e.classList.contains("canMove")?(e.setAttribute("draggable","true"),e.addEventListener("dragstart",s),e.addEventListener("dragend",r)):(e.removeAttribute("draggable"),e.removeEventListener("dragstart",s),e.removeEventListener("dragend",r))})),t.addEventListener("dragover",a),t.addEventListener("drop",l),n.onDragOver=a,n.onDrop=l};var o=n,s=()=>{const t=e.size,n=Math.sqrt(t),o=e.emptyCellPostion;return{leftTop:[o+1,o+n],rightTop:[o-1,o+n],leftBot:[o-n,o+1],rightBot:[o-n,o-1],topCenter:[o-1,o+1,o+n],botCenter:[o-1,o-n,o+1],leftCenter:[o-n,o+1,o+n],rightCenter:[o-n,o-1,o+n],center:[o-1,o+1,o-n,o+n]}[(()=>{const t=e.size,n=Math.sqrt(t),o=e.emptyCellPostion,s=n,r=t-n+1,a=t,l=[],i=[];let c=r-n;for(;c>1;)l.push(c),c-=n;let d=a-n;for(;d>s;)i.push(d),d-=n;return 1===o?"leftTop":o===s?"rightTop":o===r?"leftBot":o===a?"rightBot":o>1&&o<n?"topCenter":o>r&&o<a?"botCenter":l.includes(o)?"leftCenter":i.includes(o)?"rightCenter":"center"})()]},r=t=>{const n=((t,n)=>{let o,r=[];e.emptyCellPostion=t;for(let e=1;e<=t;e++)r.push(e);n=e.numOfMoves||(Math.random()+100)*t/2;for(let a=0;a<n;a++){let n=s(),a=n[Math.floor(Math.random()*n.length)];for(;r.indexOf(o)+1===a;)a=n[Math.floor(Math.random()*n.length)];o=a;let l=r.indexOf(t),i=r[l];r[l]=r[a-1],r[a-1]=i,e.emptyCellPostion=a}return r})(t),o=document.createDocumentFragment(),r=()=>{const e=document.createElement("div");e.classList.add("cell");const o=n.shift();if(o!==t){const t=document.createElement("div");t.classList.add("number"),t.textContent=o,e.appendChild(t)}return e.dataset.number=o,e};for(let n=1;n<=t;n++){const t=r();t.dataset.position=n,o.appendChild(t),+t.dataset.number===e.size&&(e.emptyCellPostion=n)}return e.cellsCanMove=s(),o},a=()=>{const t=document.querySelectorAll(".cell"),n=e.cellsCanMove;t.forEach((e=>{const t=+e.dataset.position;n.includes(t)?e.setAttribute("onclick","changeCellPosition(this, true)"):e.removeAttribute("onclick")}))},l=()=>{const e=document.querySelector(".popup"),t=document.querySelector(".overlay"),n=document.querySelector(".popup-inner");e.classList.remove("visible"),t.style.display="none",document.body.style.overflow="",n.innerHTML=""},i=(e,t,n)=>{e.forEach((e=>e.classList.remove(n))),t.classList.add(n)},c=()=>{const t=Math.sqrt(e.size),n=document.querySelectorAll(".sizes span"),o=document.querySelector(`[data-size="${t}"]`);let s=String(e.timer.seconds).padStart(2,0),r=String(e.timer.minutes).padStart(2,0);document.getElementById("moves").textContent=e.moves,document.getElementById("time").textContent=`${r}:${s}`,document.querySelector(".size-info span").textContent=`${t}x${t}`,i(n,o,"active")},d=()=>{e.timer.time=0,e.timer.seconds=0,e.timer.minutes=0,e.moves=0,moves.textContent=e.moves,c()};const m=()=>{const t=document.getElementById("pause-btn"),n=document.getElementById("time"),o=document.querySelector(".pause-overlay");let s=setInterval(r,1e3);function r(){e.timer.started=!0,e.timer.time+=1,n.textContent=e.timer.time,e.timer.minutes=Math.floor(e.timer.time/60),e.timer.seconds=e.timer.time%60;let s=String(e.timer.seconds).padStart(2,0),r=String(e.timer.minutes).padStart(2,0);n.textContent=`${r}:${s}`,t.textContent="Pause",o.style.display="none"}function a(){s=setInterval(r,1e3),r()}function l(n){clearInterval(s),function(n){e.timer.started=!1,t.textContent="Continue",n||(o.style.display="flex")}(n)}t.addEventListener("click",(()=>{e.timer.started?l():a()})),m.pauseGame=l,m.startGame=a};var u=m;const p=()=>{const t=()=>{e.timer.started||u.startGame(),d(),S(e.size)};document.getElementById("shuffle-btn").addEventListener("click",t),p.handler=t};var v=p,y=t=>{const n=document.querySelector(".popup"),o=document.querySelector(".overlay"),s=document.querySelector(".popup-inner"),r=document.querySelector(".popup button"),a={time:`${String(e.timer.minutes).padStart(2,0)}:${String(e.timer.seconds).padStart(2,0)}`,moves:e.moves,totalSeconds:e.timer.time};if("finish"===t&&(s.textContent=`Hooray! You solved the puzzle in ${a.time} and ${a.moves} moves!`,(e=>{if(localStorage.getItem("resultsList")){const t=JSON.parse(localStorage.getItem("resultsList"));t.push(e),t.sort(((e,t)=>e.moves-t.moves)),t.sort(((e,t)=>{if(e.moves===t.moves)return e.totalSeconds-t.totalSeconds})),t.length>10&&t.pop(),localStorage.setItem("resultsList",JSON.stringify(t))}else{const t=[e];localStorage.setItem("resultsList",JSON.stringify(t))}})(a),r.addEventListener("click",v.handler,{once:!0})),"results"===t){const e=JSON.parse(localStorage.getItem("resultsList"));if(e){const t=document.createElement("ul");t.style.listStyle="none";for(let n=0;n<e.length;n++){const o=document.createElement("li");o.textContent=`${n+1}. ${e[n].time} and ${e[n].moves} moves`,t.appendChild(o)}s.appendChild(t)}else s.textContent="No results to show."}"greeting"===t&&(s.innerHTML='Привет! Есть возможность быстро решить головоломку, чтобы тратить меньше времени на проверку:) <br> Если хочешь ей воспользоваться - открой консоль и введи команду <code>setNumOfMoves(n)</code>, где вместо <code>n</code> напиши число ходов, которое сделает компьютер, "замешивая" числа. После чего нажми на "Shuffle and restart". Если хочешь отменить эту команду и вернуть исходное состояние - перезагрузи страницу'),n.classList.add("visible"),o.style.display="block",document.body.style.overflow="hidden",r.addEventListener("click",l)},f=()=>{const n=document.querySelector(".board");a(),window.changeCellPosition=(r,l)=>{const i=document.querySelector(`[data-position="${e.emptyCellPostion}"]`),c=r.querySelector(".number");if(l?(n.style.pointerEvents="none",((e,t,n)=>{const o=parseInt(window.getComputedStyle(document.querySelector(".board")).gap),s=parseInt(window.getComputedStyle(n).width)+o;switch(n.style.transition="all 0.15s",+e.dataset.position-+t.dataset.position){case 1:n.style.left=-s+"px";break;case-1:n.style.left=s+"px";break;case-Math.sqrt(state.size):n.style.top=s+"px";break;case Math.sqrt(state.size):n.style.top=-s+"px"}})(r,i,c),c.addEventListener("transitionend",(()=>{c.style.transition="none",c.style.left=0,c.style.top=0,i.appendChild(c),t(),n.style.pointerEvents="auto",i.removeEventListener("dragover",o.onDragOver),i.removeEventListener("drop",o.onDrop),o()}),{once:!0})):i.appendChild(c),e.emptyCellPostion=+r.dataset.position,i.dataset.number=r.dataset.number,r.dataset.number=e.size,e.cellsCanMove=s(),a(),(()=>{const t=document.getElementById("moves");e.moves+=1,t.textContent=e.moves})(),l||(t(),o()),(()=>{const e=document.querySelectorAll(".cell");for(let t=0;t<e.length;t++)if(e[t].dataset.position!==e[t].dataset.number)return!1;return!0})()&&(u.pauseGame(!0),y("finish"),e.sound)){const e=new Audio("./assets/sounds/win.mp3");e.volume=.7,e.play()}e.sound&&new Audio("./assets/sounds/move.mp3").play()}};const g=document.querySelector(".board");var S=(e=16,n)=>{const s=Math.sqrt(e);g.style.gridTemplateColumns=`repeat(${s}, 1fr)`,g.style.gridTemplateRows=`repeat(${s}, 1fr)`,n?g.innerHTML=n:(n=r(e),g.innerHTML="",g.appendChild(n)),t(),f(),o()};const h=document.querySelector(".size-info span");const C=document.querySelectorAll(".sizes span");var b=()=>{C.forEach((t=>{const n=Math.pow(+t.dataset.size,2);t.addEventListener("click",(()=>{e.size=n,t.classList.contains("active")||((t=>{const n=Math.sqrt(t);S(t),h.textContent=`${n}x${n}`,d(),e.timer.started||u.startGame()})(e.size),i(C,t,"active"))}))}))};const E=localStorage.getItem("gameState"),L=localStorage.getItem("cells");E&&(e=JSON.parse(E)),document.addEventListener("DOMContentLoaded",(()=>{c(),S(e.size,L),b(),u(),v(),document.getElementById("save-btn").addEventListener("click",(()=>{localStorage.setItem("gameState",JSON.stringify(e)),localStorage.setItem("cells",document.querySelector(".board").innerHTML)})),document.getElementById("results-btn").addEventListener("click",(()=>{y("results")})),(()=>{const t=document.getElementById("sound");e.sound||(t.textContent="Off"),t.addEventListener("click",(()=>{e.sound?(t.textContent="Off",e.sound=!1):(t.textContent="On",e.sound=!0)}))})(),window.setNumOfMoves=t=>{e.numOfMoves=t}})),window.state=e}();